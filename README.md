# Поиск ближайшего отделения банка ВТБ

## Проект команды eval хакатона [More Tech 5.0](https://moretech.vtb.ru/)

### Воспользоваться работающим приложением
В момент создания этого документа и некоторое время после этого запущенное приложение работае по адресу:

https://viewplace.ru

Сваггер доступен по следующему адресу:

https://viewplace.ru/swagger-ui/index.html

### Запустить локально
Чтобы стартануть проект локально нужно положить `.env` файл в текущую папку. 
Содержимое файла должно быть следующим:

```properties
TWOGIS_KEY=Ключ 2GIS API
```
Ключ можно спросить у [меня](https://t.me/eshurupov).

После этого нужно убедиться, что у вас локально установлен docker-compose.

И запустить команду:
```shell
docker-compose up -d
```

Или, возможно на Windows:
```shell
docker compose up -d
```

Эти команды скачают собранные образы и запустят их. 

Далее надо инициализировать, бд. Для этого надо сделать запросы:

1. Загрузка всех отделения
    ```http request
    POST https://localhost/api/v1/import/native/branches
    ```
2. Загрузка банкоматов в радиусе 10 км от указанной точки
    ```http request
    POST https://localhost/api/v1/import/native/atms?lon=50.134976006710495&lat=53.2011457870469
    ```
3. Загрузка банкоматов в радиусе 10 км от указанной точки
    ```http request
    POST https://localhost/api/v1/line/filtered-init
    {
        "from" : {
            "lon": 50.134976006710495,
            "lat": 53.2011457870469
        },
        "till": "2023-10-22",
        "daysBefore": 21
    }
   ```

### Структрура приложения:
Проект состоит из нескольких микросервисов, балансировщика, фронтенда и настройки docker-compose. Они лежат в соседних репозиториях:

1. [em-branches](https://github.com/eval-moretech5/em-branches)
   Сервис отделений и банкоматов. Содержит информацию о них и отдаёт её на фронтенд.
2. [em-routes](https://github.com/eval-moretech5/em-routes)
   Сервис генерации маршрута до ближайших или выбранных отделений. Взаимодействует с сервисом отделений и с адаптером поставщика api маршрутов.
3. [em-2gis-route-adapter](https://github.com/eval-moretech5/em-2gis-route-adapter)
   Адаптер к API 2GIS поиска маршрутов. Здесь реализован адаптер к API 2GIS, но можно реализовать адаптер для API Яндекса, API Google, here.com или любого другого сервиса, который ищет маршрут. Таким образом мы не привязываемся к конкретному API.
4. [em-line-statistics](https://github.com/eval-moretech5/em-line-statistics)
   Хранилище статистики данных об очередях в отделениях банка. Сервис собирает данные, отдаёт их по запросу, а также на основе своих данных прогнозирует время в очереди в конкретном отделении в конкретное время. В данный момент статистику мы генерируем сами. А с ней уже успешно работаем.
5. [em-frontend](https://github.com/eval-moretech5/em-frontend)
   Фронтенд к приложению
6. [docker-compose](https://github.com/eval-moretech5/docker-compose)
   Текущий репозиторий. Содержит балансировщик а также конфигурацию оркестратора контейнеров docker-compose.



